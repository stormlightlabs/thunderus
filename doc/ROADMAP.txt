*ROADMAP.txt*                                       Coding Agent (Thunderus) MVP

CODING AGENT MVP                                                 *agent-harness*
================================================================================

See |VISION.txt| for design philosophy, core principles, and milestone targets.

--------------------------------------------------------------------------------
CONTENTS                                                      *roadmap-contents*
--------------------------------------------------------------------------------

     I. Repo Scaffold + Config + Session Store ................. |agent-I|
    II. Provider Harness...Execution Infrastructure ............ |agent-II|
   III. TUI Harness ............................................ |agent-III|
    IV. TUI + Agent + CLI Integration .......................... |agent-IV|
     V. Core Text Processing Tools ............................. |agent-V|
    VI. Approvals + Sandboxing (Shell-First, Still Safe) ....... |agent-VI|
   VII. Diff-First Editing + Git Integration ................... |agent-VII|
  VIII. Theming / UI ........................................... |agent-VIII|
    IX. Markdown + JSONL Hybrid VCS ............................ |agent-IX|
     X. TIERED MEMORY CORE + STORE ............................. |agent-X|
    XI. LONG-TERM MEMORY STORE + RETRIEVAL ..................... |agent-XI|
   XII. MEMORY GARDENER  ....................................... |agent-XII|
  XIII. TRAJECTORY + INSPECTOR ................................. |agent-XIII|
   XIV. MIXED-INITIATIVE COLLABORATION ......................... |agent-XIV|
    XV. PROVIDER COMPLETION + DEVELOPER TOOLING ................ |agent-XV|
   XVI. EXTENSIBILITY .......................................... |agent-XVI|
  XVII. HARDENING .............................................. |agent-XVII|
 XVIII. TUI TESTING FRAMEWORK .................................. |agent-XVIII|
   XIX. LAYOUT ................................................. |agent-XIX|
    XX. PARKING LOT............................................. |agent-XX|
   XXI. REFERENCES ............................................. |agent-XXI|

--------------------------------------------------------------------------------
I. REPO SCAFFOLD + CONFIG + SESSION STORE                              *agent-I*
--------------------------------------------------------------------------------
See section |2026-01-12| for changes made.
--------------------------------------------------------------------------------
II. PROVIDER HARNESS + MINIMAL INTERACTIVE TUI                        *agent-II*
--------------------------------------------------------------------------------
See section |2026-01-13| for changes made.
--------------------------------------------------------------------------------
III. TUI HARNESS                                                     *agent-III*
--------------------------------------------------------------------------------
See section |2026-01-15| for changes made.
--------------------------------------------------------------------------------
IV. TUI + AGENT + CLI INTEGRATION                                     *agent-IV*
--------------------------------------------------------------------------------
See section |2026-01-15| for changes made.
--------------------------------------------------------------------------------
V. CORE TEXT PROCESSING TOOLS                                          *agent-V*
--------------------------------------------------------------------------------
See section |2026-01-16| for changes made.
--------------------------------------------------------------------------------
VI. APPROVALS + SANDBOXING (SHELL-FIRST, STILL SAFE)                  *agent-VI*
--------------------------------------------------------------------------------
See section |2026-01-18| for changes made.
--------------------------------------------------------------------------------
VII. DIFF-FIRST EDITING + GIT INTEGRATION                            *agent-VII*
--------------------------------------------------------------------------------
See section |2026-01-19| for changes made.
--------------------------------------------------------------------------------
VIII. UI POLISH + THEMING                                           *agent-VIII*
--------------------------------------------------------------------------------
See section |2026-01-20| for changes made.
--------------------------------------------------------------------------------
IX. MARKDOWN + JSONL HYBRID VCS                                      *agent-IX*
--------------------------------------------------------------------------------
See section |2026-01-21| for changes made.
--------------------------------------------------------------------------------
X. TIERED MEMORY CORE + STORE (REPO-NATIVE, AUDITABLE)                 *agent-X*
--------------------------------------------------------------------------------
See section |2026-01-22| for changes made.
--------------------------------------------------------------------------------
XI. LONG-TERM MEMORY + RETRIEVAL (LEXICAL FIRST, VECTORS OPT-IN)      *agent-XI*
--------------------------------------------------------------------------------
See section |2026-01-22| for changes made.
--------------------------------------------------------------------------------
XII. MEMORY GARDENER  (CONSOLIDATION, DRIFT CONTROL, AND HYGIENE)    *agent-XII*
--------------------------------------------------------------------------------
See section |2026-01-23| for changes made.
--------------------------------------------------------------------------------
XIII. TRAJECTORY + INSPECTOR (DEBUGGABLE "WHY" FOR MEMORY)          *agent-XIII*
--------------------------------------------------------------------------------
See section |2026-01-23| for changes made.
--------------------------------------------------------------------------------
XIV. MIXED-INITIATIVE COLLABORATION                                  *agent-XIV*
--------------------------------------------------------------------------------
See section |2026-01-24| for changes made.
--------------------------------------------------------------------------------
XV. PROVIDER COMPLETION + DEVELOPER TOOLING                           *agent-XV*
--------------------------------------------------------------------------------
See section |2026-01-26| for changes made.
--------------------------------------------------------------------------------
XVI. EXTENSIBILITY (SKILLS + PLUGINS)                                *agent-XVI*
--------------------------------------------------------------------------------
Make Thunderus extensible via on-demand capabilities and custom plugins.
Inspired by Pi's Skills system and token-efficient design.

- [x] Skills system (on-demand capability loading):
      - `.thunderus/skills/` directory structure
      - SKILL.md format with frontmatter (name, description)
      - `/skill:name` invocation
      - Agent auto-discovery based on task intent
- [ ] Extension points (Rust trait-based):
      - Custom tools via `ToolDefinition` trait
      - Custom commands via `CommandHandler` trait
      - Event hooks via `EventSubscriber` trait
- [ ] Plugin loading (Runtime):
      - Unified `PluginHost` abstraction
      - WASM Support (Extism based): sandboxed, safe, polyglot
      - Lua Support (mlua based): lightweight scripting
      - Host API: `log`, `read_file`, `ask_user`, `kv_store`
- [ ] Built-in extensions registry:
      - Move web_search to skill
      - Move fetch_url to skill
- [ ] MCP client (opt-in extension):
      - load MCP servers from config, import tool schemas, route calls
      - respect approval/sandbox across MCP tools[^8]

DoD:
- Skills load on-demand; custom tools can be registered without recompiling.

--------------------------------------------------------------------------------
XVII. HARDENING (TESTS + EXEC MODE)                                 *agent-XVII*
--------------------------------------------------------------------------------
Make Thunderus production-ready with regression tests and automation support.

- [ ] Harness regression tests (golden scenarios):
      - interrupt mid-tool, drift+reconcile, patch conflict UI, approval gating
- [ ] Non-interactive mode (`thunderus exec "â€¦"`) like Codex's `exec`:
      - emits JSON (machine output) + writes JSONL session log[^3]
      - Exit codes for CI/CD integration
- [ ] "review agent" (second pass) like Codex `/review` flow[^3]:
      - Confidence scoring for changes
- [ ] Session-based teaching state:
      - persist "taught concepts" in session metadata
      - track which pedagogical hints have been shown
        (e.g., `taught: [patch_conflict, risky_command]`)
      - prevent repetitive hints across session lifecycle
      - expose teaching history in session events for debugging
- [ ] Error recovery:
      - Graceful degradation on tool failures
      - Automatic retry with backoff
      - User notification on repeated failures
- [ ] TUI enhancements:
      - Permissions pane in sidebar
      - toggle verbose action trace keybind

DoD:
- Test suite covers all critical paths; `exec` mode works reliably in CI.

--------------------------------------------------------------------------------
XVIII. TUI TESTING FRAMEWORK                                       *agent-XVIII*
--------------------------------------------------------------------------------
Ensure visual regression coverage and end-to-end stability for the TUI harness.
Prevent layout regressions and ensure the agent loop handles terminal events
correctly.

Tasks:
- [ ] Widget Snapshot Infrastructure:
      - Add `insta` dependency
      - Configure snapshot directory and CI checks
- [ ] Core Widget Component Tests:
      - Welcome Screen (static render)
      - Transcript Renderer (wrapping, colors)
      - Approval Panel (risk state UI)
- [ ] Behavioral Logic Tests:
      - Event handler (input -> action)
      - Session state transitions
- [ ] PTY Integration Tests (End-to-End):
      - Headless binary launch & quit
      - Resize handling smoke test

DoD:
- `cargo test` runs unit + snapshot tests.
- CI fails on unreviewed snapshot changes.
- At least 3 major widgets have golden snapshots.

--------------------------------------------------------------------------------
XIX. LAYOUT                                                         *agent-XIX*
--------------------------------------------------------------------------------
Implement the final "Opening" and "Agent" layouts based on designated design
artifacts, ensuring a premium, polished TUI experience.

Tasks:
- [ ] Implement Opening Layout (see `doc/DESIGN.txt` |design-layout|):
      - Clean, focused entry point
- [ ] Implement Agent Layouts (see `doc/DESIGN.txt` |design-layout|):
      - "Inspire actual agent" interactions
      - Sidebar / Context panels
- [ ] Verify TUI responsiveness and styling matches design intent
- [ ] Finalize `doc/DESIGN.txt` with observed patterns

DoD:
- UI matches the visual target of `doc/DESIGN.txt`.
- Spec and implementation overlap 100%.

--------------------------------------------------------------------------------
XX. PARKING LOT                                                      *agent-XX*
--------------------------------------------------------------------------------
Session Recovery:
- Interactive session selection UI (list multiple sessions with metadata)
- Session search and filtering (by date, keyword, etc.)
- Session branching (fork from a previous session)
- Session export/import (share sessions between machines)
- Session metadata (title, tags, description)

--------------------------------------------------------------------------------
XXI. REFERENCES                                                     *agent-XXI*
--------------------------------------------------------------------------------

See |REFS.txt| for external resources, design inspirations, and footnotes.
